using System.Text.Json.Serialization;

namespace Stix.Models;

public class Vulnerability
{
    public Vulnerability(string type, string specVersion, string id, DateTime created, DateTime modified, string name)
    {
        Type = type;
        SpecVersion = specVersion;
        Id = id;
        Created = created;
        Modified = modified;
        Name = name;
    }

    [JsonPropertyName("type")]
    public string Type { get; set; }

    [JsonPropertyName("spec_version")]
    public string SpecVersion { get; set; }

    [JsonPropertyName("id")]
    public string Id { get; set; }
    
    [JsonPropertyName("created")]
    public DateTime Created { get; set; }

    [JsonPropertyName("modified")]
    public DateTime Modified { get; set; }

    [JsonPropertyName("name")]
    public string Name { get; set; }

    [JsonPropertyName("description")]
    public string? Description { get; set; }
    
    [JsonPropertyName("confidence")]
    public int? Confidence { get; set; }
    
    [JsonPropertyName("lang")]
    public string? Lang { get; set; }
    
    [JsonPropertyName("created_by_ref")]
    public string? CreatedByRef { get; set; }
    
    [JsonPropertyName("revoked")]
    public bool Revoked { get; set; }
    
    [JsonPropertyName("granular_markings")]
    public List<GranularMarking> GranularMarkings { get; set; } = new();
    
    [JsonPropertyName("object_marking_refs")]
    public List<string> ObjectMarkingRefs { get; set; } = new();

    [JsonPropertyName("labels")] 
    public List<string> Labels { get; set; } = new();

    [JsonPropertyName("external_references")]
    public List<ExternalReference> ExternalReferences { get; set; } = new();
}

public class ExternalReference
{
    public ExternalReference(string sourceName, string externalId)
    {
        SourceName = sourceName;
        ExternalId = externalId;
    }

    [JsonPropertyName("source_name")]
    public string SourceName { get; set; }

    [JsonPropertyName("external_id")]
    public string ExternalId { get; set; }
}

public class GranularMarking
{
    public GranularMarking(string lang, string markingRef)
    {
        Lang = lang;
        MarkingRef = markingRef;
    }

    [JsonPropertyName("selectors")]
    public List<string> Selectors { get; set; } = new ();

    [JsonPropertyName("lang")]
    public string Lang { get; set; }

    [JsonPropertyName("marking_ref")]
    public string MarkingRef { get; set; }
}